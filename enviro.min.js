!function(){"use strict";var b=function(a){return this.__createEnvironment(a)};b.ProtoEnvironment=function(b){this.__construct=function(b){if(this.__environmentName=b.name,!this.hasName())throw new Error("Environment has no name");if(this.__environmentUserAgent=b.ua,this.setEnvironmentTriggers(b.trigger),!this.hasEnvironmentTriggers()&&!this.hasUserAgent())throw new Error("Unable to add environment: no UserAgent regex or environment triggers...");this.__environmentOnAction={};for(a in b.events)this.setEnvironmentOnAction(a,b.events[a])},this.getEnvironmentOnAction=function(a){return this.__environmentOnAction[a]},this.setEnvironmentOnAction=function(a,b){if("function"!=typeof b){if(void 0===b)return;throw new Error("OnInit should be a single function")}this.__environmentOnAction[a]=b},this.getName=function(){return this.__environmentName},this.hasName=function(){var a=this.getName();return"string"==typeof a&&""!==a?!0:!1},this.getUserAgent=function(){return this.__environmentUserAgent},this.hasUserAgent=function(){var a=this.getUserAgent();if(!a)return!1;if(a instanceof RegExp)return!0;throw new Error("User agent should be a regex")},this.getEnvironmentTriggers=function(){return this.__environmentTriggers},this.hasEnvironmentTriggers=function(){return 0===this.getEnvironmentTriggers().length?!1:!0},this.setEnvironmentTriggers=function(a){if(this.__environmentTriggers=[],a)if(a.constructor===Array)for(t in a)this.addEnvironmentTrigger(a[t]);else{if("function"!=typeof a)throw new Error("Triggers should be either a single function or an array of functions");this.addEnvironmentTrigger(a)}},this.addEnvironmentTrigger=function(a){if("function"!=typeof a)throw new Error("Trigger should be a function");this.__environmentTriggers.push(a)},this.__construct(b)},b.__addEnvironment=function(a){if(1!==arguments.length||!(a instanceof Environment.ProtoEnvironment))throw new Error("Unable to add environment: this function should only be called with a single ProtoEnvironment as a parameter");return this[a.getName()]=a,this[a.getName()]},b.__createEnvironment=function(a){this.__addEnvironment(new Environment.ProtoEnvironment(a))},b.forEach=function(a){for(p in this)this[p]instanceof Environment.ProtoEnvironment&&a(p,this[p])},b.trigger=function(a,b){var c=this[b],d=c.getEnvironmentTriggers();for(t in d)if(d[t]()!==!0)return;try{c.getEnvironmentOnAction(a)()}catch(e){}},b.triggerAll=function(a){var b=this;this.forEach(function(c,d){b.trigger(a,c)})},b.tools={ieVersion:function(){if("Microsoft Internet Explorer"==navigator.appName){var a=navigator.userAgent,b=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=b.exec(a)&&(rv=parseFloat(RegExp.$1))}return rv}}}();